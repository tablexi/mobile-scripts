#!/usr/bin/env ruby
require 'colorize'

puts "Cleaning all react-native caches we know about so far..."

def run(cmd)
  puts cmd.cyan + ' ' + `#{cmd}`
end

run "watchman watch-del-all"
run "rm -rf $TMPDIR/react-*"
run "rm ~/.babel.json"
run "rm -rf ~/.rncache"
run "rm -rf ios/build"
run "rm -rf ios/Pods"
run "rm -rf node_modules/"
run "npm cache clean --force"
run "npm install"

#this is important - the cache needs to be reloaded manually
puts "Manually refreshing packages..."
pid = Process.spawn "npm run start -- --reset-cache"
sleep(10)
run "curl http://localhost:8081/index.bundle?platform=ios&dev=true > /dev/null"

puts "Clean finished ğŸš€".green

